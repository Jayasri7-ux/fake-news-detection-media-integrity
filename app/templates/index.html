<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fake News Detection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#f4f6f8;--card:#fff;--text:#222;--muted:#666;
 --primary:#4f46e5;--fake:#dc2626;--real:#16a34a;--medium:#f59e0b;
}
body.dark{
 --bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;
}
body{
 margin:0;font-family:Segoe UI;background:var(--bg);color:var(--text);
 display:flex;justify-content:center;padding:30px;
}
.container{max-width:760px;width:100%}
.card{
 background:var(--card);border-radius:12px;padding:20px;
 box-shadow:0 10px 25px rgba(0,0,0,.08);margin-bottom:20px;
}
.toggle{cursor:pointer;padding:6px 12px;border-radius:20px;
 background:var(--primary);color:#fff;font-size:14px}
textarea{
 width:100%;height:140px;border-radius:8px;border:1px solid #ccc;
 padding:12px;font-size:15px;resize:none;background:transparent;color:var(--text)
}
.btn{background:var(--primary);color:#fff;padding:10px 18px;
 border:none;border-radius:8px;cursor:pointer}
.badge{padding:6px 12px;border-radius:20px;color:#fff;font-size:13px}
.badge.fake{background:var(--fake)}
.badge.real{background:var(--real)}
.badge.high{background:var(--fake)}
.badge.medium{background:var(--medium)}
.badge.low{background:var(--real)}
.progress{background:#ddd;height:10px;border-radius:10px;overflow:hidden}
.progress-fill{height:100%;background:#22c55e;width:0}
.chart-wrapper{width:280px;height:280px;margin:auto}
.result{display:none}

pre{
 white-space:pre-wrap;
 background:#f1f1f1;
 color:#111;
 padding:12px;
 border-radius:8px;
 max-height:220px;
 overflow:auto;
}
body.dark pre{
 background:#020617;
 color:#e5e7eb;
 border:1px solid #334155;
}

/* History */
.history-item{
 padding:8px;
 border-bottom:1px solid #ddd;
 cursor:pointer;
 font-size:14px;
}
.history-item:hover{background:#e5e7eb}
body.dark .history-item:hover{background:#1e293b}
</style>
</head>

<body>
<div class="container">

<!-- Header -->
<div style="display:flex;justify-content:space-between;align-items:center">
<h1>ðŸ“° Fake News Detection</h1>
<div class="toggle" onclick="toggleTheme()">ðŸŒ— Toggle</div>
</div>

<!-- Input -->
<div class="card">
<p>Paste <b>news text</b> or a <b>news article URL</b>.</p>
<textarea id="newsInput"></textarea><br><br>
<button class="btn" onclick="analyze()">Analyze</button>
</div>

<!-- History Panel -->
<div class="card">
<h3>ðŸ•’ Analysis History (last 5)</h3>
<div id="historyList" style="font-size:14px;color:var(--muted)">
 No history yet
</div>
</div>

<!-- Extracted Content -->
<div id="extractedCard" class="card" style="display:none">
<h3>ðŸ§¾ Extracted News Content</h3>
<pre id="extractedText"></pre>
</div>

<!-- Results -->
<div id="resultCard" class="card result">
<h3>ðŸ“Š Analysis Result</h3>

<p><b>Prediction:</b> <span id="predictionBadge" class="badge"></span></p>
<p>Confidence: <span id="confidenceText"></span></p>
<div class="progress"><div id="confidenceBar" class="progress-fill"></div></div>

<p id="modeText"></p>
<p><b>Risk Level:</b> <span id="riskBadge" class="badge"></span></p>

<ul id="explanationList"></ul>

<h3>ðŸ¥§ Confidence Distribution</h3>
<div class="chart-wrapper"><canvas id="confidenceChart"></canvas></div>

<h3>ðŸ“¥ Download</h3>
<button class="btn" onclick="downloadTXT()">TXT</button>
<button class="btn" onclick="downloadChart()">Chart</button>
<button class="btn" onclick="downloadPDF()">PDF</button>
</div>

</div>

<script>
let chart=null;
function toggleTheme(){document.body.classList.toggle("dark")}
function isURL(t){return t.startsWith("http")}

// ---------- HISTORY ----------
function loadHistory(){
 const history=JSON.parse(localStorage.getItem("analysisHistory")||"[]");
 const list=document.getElementById("historyList");
 if(history.length===0){list.innerHTML="No history yet";return;}
 list.innerHTML="";
 history.forEach(item=>{
  const div=document.createElement("div");
  div.className="history-item";
  div.textContent=`${item.input.slice(0,40)}... â†’ ${item.prediction} (${item.confidence}%)`;
  div.onclick=()=>{document.getElementById("newsInput").value=item.input;}
  list.appendChild(div);
 });
}

function saveHistory(input,pred,conf){
 let history=JSON.parse(localStorage.getItem("analysisHistory")||"[]");
 history.unshift({input,prediction:pred,confidence:conf});
 history=history.slice(0,5);
 localStorage.setItem("analysisHistory",JSON.stringify(history));
 loadHistory();
}

// ---------- ANALYZE ----------
async function analyze(){
 const text=document.getElementById("newsInput").value.trim();
 if(!text) return alert("Enter text or URL");

 const res=await fetch("/predict",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({text,is_url:isURL(text)})
 });

 const data=await res.json();
 if(data.error) return alert(data.error);

 if(data.extracted_text){
  document.getElementById("extractedCard").style.display="block";
  document.getElementById("extractedText").textContent=data.extracted_text;
 } else {
  document.getElementById("extractedCard").style.display="none";
 }

 document.getElementById("resultCard").style.display="block";
 document.getElementById("predictionBadge").textContent=data.prediction;
 document.getElementById("predictionBadge").className="badge "+(data.prediction==="Fake"?"fake":"real");

 const conf=Math.round(data.confidence*100);
 document.getElementById("confidenceText").textContent=conf+"%";
 document.getElementById("confidenceBar").style.width=conf+"%";

 document.getElementById("modeText").textContent="Mode: "+data.mode;
 document.getElementById("riskBadge").textContent=data.risk_level;
 document.getElementById("riskBadge").className="badge "+data.risk_level.toLowerCase();

 const list=document.getElementById("explanationList");
 list.innerHTML="";
 (data.explanation||[]).forEach(e=>{
  const li=document.createElement("li");li.textContent=e;list.appendChild(li)
 });

 const ctx=document.getElementById("confidenceChart");
 if(chart) chart.destroy();
 chart=new Chart(ctx,{
  type:"pie",
  data:{labels:["Real","Fake"],
  datasets:[{data:[conf,100-conf],backgroundColor:["#16a34a","#dc2626"]}]},
  options:{maintainAspectRatio:false}
 });

 saveHistory(text,data.prediction,conf);
}

// ---------- DOWNLOADS ----------
function downloadTXT(){
 const t=`Prediction: ${document.getElementById("predictionBadge").textContent}\nConfidence: ${document.getElementById("confidenceText").textContent}`;
 const a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([t]));
 a.download="result.txt";a.click();
}
function downloadChart(){
 const a=document.createElement("a");
 a.href=document.getElementById("confidenceChart").toDataURL();
 a.download="chart.png";a.click();
}
async function downloadPDF(){
 const canvas=document.getElementById("confidenceChart");
 const payload={prediction:document.getElementById("predictionBadge").textContent,
 confidence:parseInt(document.getElementById("confidenceText").textContent)/100,
 mode:document.getElementById("modeText").textContent,
 risk_level:document.getElementById("riskBadge").textContent,
 chart:canvas.toDataURL()};
 const res=await fetch("/download-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
 const blob=await res.blob();
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);a.download="report.pdf";a.click();
}

loadHistory();
</script>
</body>
</html>
