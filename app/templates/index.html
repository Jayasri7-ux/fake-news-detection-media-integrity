<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fake News Detection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#f4f6f8;--card:#fff;--text:#222;--muted:#666;
 --primary:#4f46e5;--fake:#dc2626;--real:#16a34a;--medium:#f59e0b;
}
body.dark{
 --bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;
}
body{
 margin:0;font-family:Segoe UI;background:var(--bg);color:var(--text);
 display:flex;justify-content:center;padding:30px;
}
.container{max-width:760px;width:100%}
.card{
 background:var(--card);border-radius:12px;padding:20px;
 box-shadow:0 10px 25px rgba(0,0,0,.08);margin-bottom:20px;
}
.toggle{cursor:pointer;padding:6px 12px;border-radius:20px;
 background:var(--primary);color:#fff;font-size:14px}
textarea{
 width:100%;height:140px;border-radius:8px;border:1px solid #ccc;
 padding:12px;font-size:15px;resize:none;background:transparent;color:var(--text)
}
.btn{background:var(--primary);color:#fff;padding:10px 18px;
 border:none;border-radius:8px;cursor:pointer}
.badge{padding:6px 12px;border-radius:20px;color:#fff;font-size:13px}
.badge.fake{background:var(--fake)}
.badge.real{background:var(--real)}
.badge.high{background:var(--fake)}
.badge.medium{background:var(--medium)}
.badge.low{background:var(--real)}
.progress{background:#ddd;height:10px;border-radius:10px;overflow:hidden}
.progress-fill{height:100%;background:#22c55e;width:0}
.chart-wrapper{width:280px;height:280px;margin:auto}
.result{display:none}
pre{
 white-space:pre-wrap;
 background:#f1f1f1;
 color:#111;
 padding:12px;
 border-radius:8px;
 max-height:220px;
 overflow:auto;
}

/* âœ… Dark mode fix for extracted text */
body.dark pre{
 background:#020617;      /* dark navy */
 color:#e5e7eb;           /* readable light text */
 border:1px solid #334155;
}

</style>
</head>

<body>
<div class="container">

<div style="display:flex;justify-content:space-between;align-items:center">
<h1>ðŸ“° Fake News Detection</h1>
<div class="toggle" onclick="toggleTheme()">ðŸŒ— Toggle</div>
</div>

<div class="card">
<p>Paste <b>news text</b> or a <b>news article URL</b>.</p>
<textarea id="newsInput"></textarea><br><br>
<button class="btn" onclick="analyze()">Analyze</button>
</div>

<!-- Extracted Content -->
<div id="extractedCard" class="card" style="display:none">
<h3>ðŸ§¾ Extracted News Content</h3>
<pre id="extractedText"></pre>
</div>

<div id="resultCard" class="card result">
<h3>ðŸ“Š Analysis Result</h3>

<p><b>Prediction:</b> <span id="predictionBadge" class="badge"></span></p>
<p>Confidence: <span id="confidenceText"></span></p>
<div class="progress"><div id="confidenceBar" class="progress-fill"></div></div>

<p id="modeText"></p>
<p><b>Risk Level:</b> <span id="riskBadge" class="badge"></span></p>

<ul id="explanationList"></ul>

<h3>ðŸ¥§ Confidence Distribution</h3>
<div class="chart-wrapper"><canvas id="confidenceChart"></canvas></div>

<h3>ðŸ“¥ Download</h3>
<button class="btn" onclick="downloadTXT()">TXT</button>
<button class="btn" onclick="downloadChart()">Chart</button>
<button class="btn" onclick="downloadPDF()">PDF</button>
</div>

</div>

<script>
let chart=null;
function toggleTheme(){document.body.classList.toggle("dark")}
function isURL(t){return t.startsWith("http")}

async function analyze(){
 const text=document.getElementById("newsInput").value.trim();
 if(!text) return alert("Enter text or URL");

 const res=await fetch("/predict",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({text,is_url:isURL(text)})
 });

 const data=await res.json();
 if(data.error) return alert(data.error);

 // SHOW EXTRACTED TEXT IF URL
 if(data.extracted_text){
  document.getElementById("extractedCard").style.display="block";
  document.getElementById("extractedText").textContent=data.extracted_text;
 } else {
  document.getElementById("extractedCard").style.display="none";
 }

 document.getElementById("resultCard").style.display="block";
 document.getElementById("predictionBadge").textContent=data.prediction;
 document.getElementById("predictionBadge").className="badge "+(data.prediction==="Fake"?"fake":"real");

 const conf=Math.round(data.confidence*100);
 document.getElementById("confidenceText").textContent=conf+"%";
 document.getElementById("confidenceBar").style.width=conf+"%";

 document.getElementById("modeText").textContent="Mode: "+data.mode;
 document.getElementById("riskBadge").textContent=data.risk_level;
 document.getElementById("riskBadge").className="badge "+data.risk_level.toLowerCase();

 const list=document.getElementById("explanationList");
 list.innerHTML="";
 (data.explanation||[]).forEach(e=>{
  const li=document.createElement("li");li.textContent=e;list.appendChild(li)
 });

 const ctx=document.getElementById("confidenceChart");
 if(chart) chart.destroy();
 chart=new Chart(ctx,{
  type:"pie",
  data:{labels:["Real","Fake"],
  datasets:[{data:[conf,100-conf],backgroundColor:["#16a34a","#dc2626"]}]},
  options:{maintainAspectRatio:false}
 });
}
</script>
</body>
</html>
